<?xml version="1.0" encoding="UTF-8"?>
<project name="xp-framework-release" basedir="." xmlns:ivy="antlib:org.apache.ivy.ant">

  <target name="xp.get.resolver" depends="xp.get.resolver.integration, xp.get.resolver.release, xp.get.overwrite"/>

  <target name="xp.get.resolver.integration" if="xp.build.mode.integration">
    <property name="xp.publish.resolver" value="shared-publish-snapshots"/>
    <property name="xp.overwrite" value="true"/>
  </target>

  <target name="xp.get.resolver.milestone" if="xp.build.mode.milestone">
    <property name="xp.publish.resolver" value="shared-publish-milestones"/>
  </target>

  <target name="xp.get.resolver.release" if="xp.build.mode.release">
    <property name="xp.publish.resolver" value="shared-publish-releases"/>
  </target>

  <target name="xp.install" extensionOf="install" depends="ivy-info, xp.get.resolver">
    <echo>===> Installing ${ivy.organisation}#${ivy.module} @ local</echo>

    <ivy:publish
     artifactspattern="${build.target}/[artifact]-[revision].[ext]"
     revision="${ivy.new.revision}"
     resolver="local"
     overwrite="true"
     publishivy="true"
    />
  </target>

  <target name="xp.publish" extensionOf="publish" depends="ivy-info, xp.get.resolver">
    <echo>===> Deploying ${ivy.organisation}#${ivy.module} @ ${xp.publish.resolver}</echo>

    <!-- Declare if not declared previously -->
    <property name="xp.overwrite" value="false"/>

    <ivy:publish
     artifactspattern="${build.target}/[artifact]-[revision].[ext]"
     revision="${ivy.new.revision}"
     resolver="${xp.publish.resolver}"
     overwrite="${xp.overwrite}"
     publishivy="true"
    />
  </target>
</project>
