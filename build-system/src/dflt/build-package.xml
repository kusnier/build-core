<?xml version="1.0" encoding="UTF-8"?>
<project name="xp-framework-package" basedir="." xmlns:ivy="antlib:org.apache.ivy.ant">
  
  <target name="xp.package.sources" extensionOf="package" depends="xp.setup.ivy, xp.build.number">
    <xar
     dir="${build.target.classes}"
     target="${build.target}/${ivy.module}-${ivy.new.revision}.xar"
    />
  </target>

  <target name="xp.package.tests.exist">
    <fileset id="tests" dir="${build.target.testClasses}"/>
    <pathconvert property="xp.tests.exist" refid="tests" setonempty="false"/>
  </target>

  <target name="xp.package.tests" extensionOf="package" depends="xp.setup.ivy, xp.build.number, xp.package.tests.exist" if="xp.tests.exist">
    <xar
     dir="${build.target.testClasses}"
     target="${build.target}/${ivy.module}-test-${ivy.new.revision}.xar"
    />
  </target>

  <target name="xp.package.meta" extensionOf="package" depends="xp.setup.ivy, xp.package.sources, xp.package.tests">
    <echo>===> Packaging ${ivy.organisation}#${ivy.module}</echo>
  </target>

  <!-- FIXME: Temporarily disabled source packaging, as there is an issue
   !   w/ stripping path elements -->
  <target name="xp.package.source.artifact" depends="xp.setup.ivy">
    <zip file="${build.target}/${ivy.module}-${ivy.new.revision}-sources.zip">
      <mappedresources>
        <fileset refid="build.sources.fileset.php"/>
        <cutdirsmapper dirs="1"/>
      </mappedresources>
      <mappedresources>
        <fileset refid="build.sources.fileset.xsl"/>
        <cutdirsmapper dirs="1"/>
      </mappedresources>
      <mappedresources>
        <fileset refid="build.testSourceDirectory"/>
        <cutdirsmapper dirs="1"/>
      </mappedresources>
      <mappedresources>
        <fileset refid="build.testConfigurations"/>
        <cutdirsmapper dirs="1"/>
      </mappedresources>
    </zip>
  </target>
</project>
