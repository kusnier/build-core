<?xml version="1.0"?>
<project name="xp-framework-master" basedir="." xmlns:ivy="antlib:org.apache.ivy.ant">
  <dirname property="include.base" file="${ant.file.xp-framework-master}"/>

  <!-- RELEASE or INTEGRATION -->
  <property name="ivy.publish.status" value="integration"/>
  
  <!-- -SNAPSHOT or empty -->
  <property name="project.qualifier" value=""/>
  
  <!-- Private settings -->
  <property name="build.target" value="${basedir}/target"/>
  <property name="build.target.classes" value="${build.target}/classes"/>
  <property name="build.target.testClasses" value="${build.target}/test-classes"/>
  <property name="build.target.webapp" value="${build.target}/webapp"/>
  <property name="project.generated.ivy.file" value="${build.target}/ivy.xml"/>
  <property name="project.generated.pom.file" value="${build.target}/pom.xml"/>
  
  <available property="build.test.exist.unittest.ini" file="${basedir}/unittest.ini"/>
  
  <target name="setup-ivy" extensionOf="prepare" depends="install-ivy">
    <ivy:settings file="${include.base}/ivysettings.xml"/>
  </target>
  
  <target name="ivy-info">
    <ivy:info/>
  </target>

  <target name="xp.setup.paths" extensionOf="prepare">
    <ivy:resolve/>
    
    <ivy:cachefileset
     type="zip"
     setid="build.bootstrap"
    />

    <unzip dest="${build.target}/bootstrap">
      <fileset refid="build.bootstrap"/>
    </unzip>
  </target>
  
  <target name="xp.install" extensionOf="install" depends="ivy-info">
    <echo>===> Installing ${ivy.organisation}#${ivy.module} @ local</echo>

    <ivy:publish
     artifactspattern="${build.target}/[artifact]-[revision].[ext]"
     resolver="local"
     revision="${ivy.revision}${project.qualifier}"
     pubrevision="${ivy.revision}${project.qualifier}"
     pubdate="now"
     overwrite="true"
     publishivy="true"
     status="${ivy.publish.status}"
    />
  </target>
  
  <target name="xp.deploy" extensionOf="deploy" depends="ivy-info">
    <echo>===> Deploying ${ivy.organisation}#${ivy.module} @ public-authenticated</echo>
    <ivy:publish
     artifactspattern="${build.target}/[artifact]-[revision].[ext]"
     resolver="public-authenticated"
     revision="${ivy.revision}${project.qualifier}"
     pubrevision="${ivy.revision}${project.qualifier}"
     pubdate="now"
     overwrite="true"
     publishivy="true"
     status="${ivy.publish.status}"
    />
  </target>

  <target name="xp.clean.ivycache" extensionOf="clean" depends="ivy-info">
    <ivy:cleancache/>
  </target>
  
  <target name="xp.clean" extensionOf="clean">
    <delete dir="${build.target}"/>
  </target>
</project>
